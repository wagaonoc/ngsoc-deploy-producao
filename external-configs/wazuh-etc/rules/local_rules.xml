<!-- ========== Harbor Rules ========== -->
<group name="harbor-rules">

  <rule id="100900" level="7">
    <decoded_as>harbor-core-json</decoded_as>
    <description>Harbor core: falha de autenticação (401)</description>
    <regex field="status">401</regex>
  </rule>

  <rule id="100901" level="8">
    <decoded_as>harbor-core-json</decoded_as>
    <description>Harbor core: acesso proibido (403)</description>
    <regex field="status">403</regex>
  </rule>

  <rule id="100902" level="10">
    <decoded_as>harbor-core-json</decoded_as>
    <description>Harbor core: erro interno (500)</description>
    <regex field="status">500</regex>
  </rule>

  <rule id="100903" level="10">
    <decoded_as>harbor-core-json</decoded_as>
    <regex field="method">DELETE</regex>
    <description>ALERTA CRÍTICO: Artefato/Imagem DELETADO(A) do Harbor - Usuário: $(operator)</description>
  </rule>

  <rule id="100910" level="0">
    <decoded_as>harbor-jobservice-json</decoded_as>
    <description>Harbor jobservice: status 200</description>
    <regex field="status">200</regex>
  </rule>

  <rule id="100911" level="7">
    <decoded_as>harbor-jobservice-json</decoded_as>
    <description>Harbor jobservice: erro</description>
    <regex field="status">[^2]..\d</regex>
  </rule>

  <rule id="100920" level="5">
    <decoded_as>trivy-adapter-json</decoded_as>
    <description>Harbor Trivy: status 200</description>
    <regex field="status">200</regex>
  </rule>

  <rule id="100921" level="7">
    <decoded_as>trivy-adapter-json</decoded_as>
    <description>Harbor Trivy: erro</description>
    <regex field="status">[^2]..\d</regex>
  </rule>

</group>

<!-- ========== Metasploit Rules ========== -->
<group name="metasploit-rules">

  <rule id="101000" level="5">
    <decoded_as>metasploit-audit</decoded_as>
    <description>Metasploit: evento detectado</description>
  </rule>

  <rule id="101001" level="7">
    <decoded_as>metasploit-audit</decoded_as>
    <match>Spooling to file</match>
    <description>Metasploit: início de sessão de console / spool de saída</description>
  </rule>

  <rule id="101002" level="10">
    <decoded_as>metasploit-audit</decoded_as>
    <match>Meterpreter session opened</match>
    <description>Metasploit: sessão Meterpreter aberta</description>
  </rule>

  <rule id="101003" level="5">
    <decoded_as>metasploit-audit</decoded_as>
    <match>Meterpreter session closed</match>
    <description>Metasploit: sessão Meterpreter finalizada</description>
  </rule>

  <rule id="101004" level="10">
    <decoded_as>metasploit-audit</decoded_as>
    <match>Exploit completed, result: success</match>
    <description>Metasploit: exploit completado com sucesso</description>
  </rule>

  <rule id="101005" level="8">
    <decoded_as>metasploit-audit</decoded_as>
    <match>(Uploading:|Wrote:|Saved payload to)</match>
    <description>Metasploit: upload ou gravação de payload detectado</description>
  </rule>

</group>
<!-- Mitmproxy: regra de teste simples -->
<group name="mitmproxy-rules">
  <rule id="101100" level="7">
    <decoded_as>mitmproxy-audit</decoded_as>
    <description>Mitmproxy: teste REAL detectado (marca MITM-WAZUH-REAL)</description>
  </rule>
</group>

<!-- ========== OWASP ZAP Rules ========== -->
<group name="zap-rules">
  <rule id="110300" level="5">
    <decoded_as>zap-audit</decoded_as>
    <description>OWASP ZAP: evento detectado no log</description>
  </rule>
  <rule id="110301" level="10">
    <decoded_as>zap-audit</decoded_as>
    <match>ERROR</match>
    <description>OWASP ZAP: erro detectado no log</description>
  </rule>
</group>

<!-- ========== Trivy Rules (revisadas) ========== -->
<group name="trivy-rules">
<!-- INFO -->
  <rule id="120100" level="5">
    <decoded_as>trivy-audit</decoded_as>
    <match>[INFO]</match>
    <description>Trivy: scan informativo</description>
  </rule>

  <!-- WARN -->
  <rule id="120101" level="7">
    <decoded_as>trivy-audit</decoded_as>
    <match>[WARN]</match>
    <description>Trivy: vulnerabilidade detectada</description>
  </rule>

  <!-- ERROR -->
  <rule id="120102" level="10">
    <decoded_as>trivy-audit</decoded_as>
    <match>[ERROR]</match>
    <description>Trivy: erro crítico no motor de scan</description>
  </rule> 
</group>

<!-- ========== Greenbone / OpenVAS Rules ========== -->
<group name="greenbone-rules">

  <rule id="130000" level="5">
    <decoded_as>greenbone-audit</decoded_as>
    <description>Greenbone/OpenVAS: evento genérico detectado</description>
  </rule>

  <rule id="130001" level="7">
    <decoded_as>greenbone-audit</decoded_as>
    <match>Failed</match>
    <description>Greenbone/OpenVAS: falha detectada (autenticação, conexão ou scan)</description>
  </rule>

  <rule id="130002" level="8">
    <decoded_as>greenbone-audit</decoded_as>
    <match>Connection refused</match>
    <description>Greenbone/OpenVAS: conexão com scanner recusada</description>
  </rule>

  <rule id="130003" level="10">
    <decoded_as>greenbone-audit</decoded_as>
    <match>CRITICAL</match>
    <description>Greenbone/OpenVAS: erro crítico</description>
  </rule>

  <rule id="130004" level="3">
    <decoded_as>openvas-audit</decoded_as>
    <match>started</match>
    <description>OpenVAS Scanner: início de varredura</description>
  </rule>

  <rule id="130005" level="5">
    <decoded_as>openvas-audit</decoded_as>
    <match>finished</match>
    <description>OpenVAS Scanner: varredura concluída</description>
  </rule>

  <rule id="130006" level="10">
    <decoded_as>openvas-audit</decoded_as>
    <match>database is locked</match>
    <description>OpenVAS: erro de banco de dados bloqueado</description>
  </rule>
</group>

<!-- ========== Greenbone OSPD Rules ========== -->
<!-- ========== Greenbone OSPD Rules (corrigidas) ========== -->
<group name="greenbone-rules,ospd">

  <rule id="130010" level="3">
    <decoded_as>greenbone-ospd-log</decoded_as>
    <description>Greenbone OSPD: evento informativo</description>
    <options>no_full_log</options>
    <match>INFO</match>
  </rule>

  <rule id="130011" level="7">
    <decoded_as>greenbone-ospd-log</decoded_as>
    <description>Greenbone OSPD: alerta WARNING</description>
    <match>WARN</match>
  </rule>

  <rule id="130012" level="10">
    <decoded_as>greenbone-ospd-log</decoded_as>
    <description>Greenbone OSPD: erro crítico</description>
    <match>CRITICAL</match>
  </rule>

</group>

<!-- Alertas VirusTotal -->
<group name="local,">
  <!-- Suas regras personalizadas -->
  <rule id="100500" level="8">
    <decoded_as>virustotal-detection</decoded_as>
    <description>VirusTotal: hash $(sha256) detectado por $(detections)/$(total) mecanismos</description>
    <group>virustotal,malware</group>
  </rule>

  <rule id="100501" level="4">
    <decoded_as>virustotal-warning</decoded_as>
    <description>VirusTotal: hash $(sha256) não encontrado ou limite da API atingido</description>
    <group>virustotal,info</group>
  </rule>
</group>
