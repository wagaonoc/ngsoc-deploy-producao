<group name="harbor-rules">

  <!-- Harbor Core Logs -->
  <!-- Detecta 401 -->
  <rule id="100900" level="7">
    <decoded_as>harbor-core-json</decoded_as>
    <description>Harbor core: falha de autenticação (401)</description>
    <regex field="status">401</regex>
  </rule>

  <!-- Detecta 403 -->
  <rule id="100901" level="8">
    <decoded_as>harbor-core-json</decoded_as>
    <description>Harbor core: acesso proibido (403)</description>
    <regex field="status">403</regex>
  </rule>

  <!-- Detecta 500 -->
  <rule id="100902" level="10">
    <decoded_as>harbor-core-json</decoded_as>
    <description>Harbor core: erro interno (500)</description>
    <regex field="status">500</regex>
  </rule>

  <!-- Harbor Jobservice Logs -->
  <!-- Detecta status 200 -->
  <rule id="100910" level="0">
    <decoded_as>harbor-jobservice-json</decoded_as>
    <description>Harbor jobservice: status 200</description>
    <regex field="status">200</regex>
  </rule>

  <!-- Detecta status diferente de 200 -->
  <rule id="100911" level="7">
    <decoded_as>harbor-jobservice-json</decoded_as>
    <description>Harbor jobservice: erro</description>
    <regex field="status">[^2]..\d</regex>
  </rule>

  <!-- Trivy Adapter Logs -->
  <!-- Detecta status 200 -->
  <rule id="100920" level="5">
    <decoded_as>trivy-adapter-json</decoded_as>
    <description>Harbor Trivy: status 200</description>
    <regex field="status">200</regex>
  </rule>

  <!-- Detecta status diferente de 200 -->
  <rule id="100921" level="7">
    <decoded_as>trivy-adapter-json</decoded_as>
    <description>Harbor Trivy: erro</description>
    <regex field="status">[^2]..\d</regex>
  </rule>

</group>

<!-- ========== Metasploit Rules ========== -->
<group name="metasploit,">
  <rule id="101000" level="5">
    <decoded_as>metasploit-audit</decoded_as>
    <description>Metasploit: evento detectado</description>
    <group>metasploit-rules</group>
  </rule>

  <rule id="101001" level="7">
    <decoded_as>metasploit-audit</decoded_as>
    <match>Spooling to file</match>
    <description>Metasploit: início de sessão console audit</description>
    <group>metasploit-rules</group>
  </rule>
</group>
<!-- ====================================== -->

<!-- ========== Mitmproxy Rules ========== -->
<group name="mitmproxy">
  <rule id="101100" level="5">
    <decoded_as>mitmproxy-audit</decoded_as>
    <description>Mitmproxy: evento genérico detectado</description>
    <group>mitmproxy-rules</group>
  </rule>

  <rule id="101101" level="7">
    <decoded_as>mitmproxy-audit</decoded_as>
    <match>CONNECT</match>
    <description>Mitmproxy: conexão CONNECT detectada</description>
    <group>mitmproxy-rules</group>
  </rule>

  <rule id="101102" level="5">
    <decoded_as>mitmproxy-audit</decoded_as>
    <match>MITMPROXY TESTE</match>
    <description>Mitmproxy: teste de integração</description>
    <group>mitmproxy-rules</group>
  </rule>
</group>
